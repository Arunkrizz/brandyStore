<!DOCTYPE html>
<html lang="en">

<head>
	<title>Minishop - Free Bootstrap 4 Template by Colorlib</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet">

	<link rel="stylesheet" href="userassets/css/open-iconic-bootstrap.min.css">
	<link rel="stylesheet" href="userassets/css/animate.css">

	<link rel="stylesheet" href="userassets/css/owl.carousel.min.css">
	<link rel="stylesheet" href="userassets/css/owl.theme.default.min.css">
	<link rel="stylesheet" href="userassets/css/magnific-popup.css">

	<link rel="stylesheet" href="userassets/css/aos.css">

	<link rel="stylesheet" href="userassets/css/ionicons.min.css">

	<link rel="stylesheet" href="userassets/css/bootstrap-datepicker.css">
	<link rel="stylesheet" href="userassets/css/jquery.timepicker.css">


	<link rel="stylesheet" href="userassets/css/flaticon.css">
	<link rel="stylesheet" href="userassets/css/icomoon.css">
	<link rel="stylesheet" href="userassets/css/style.css">
</head>

<body class="goto-here">
	<div class="py-1 bg-black">
		<div class="container">
			<div class="row no-gutters d-flex align-items-start align-items-center px-md-0">
				<div class="col-lg-12 d-block">
					<div class="row d-flex">
						<div class="col-md pr-4 d-flex topper align-items-center">
							<div class="icon mr-2 d-flex justify-content-center align-items-center"><span
									class="icon-phone2"></span></div>
							<span class="text">+ 1235 2355 98</span>
						</div>
						<div class="col-md pr-4 d-flex topper align-items-center">
							<div class="icon mr-2 d-flex justify-content-center align-items-center"><span
									class="icon-paper-plane"></span></div>
							<span class="text">youremail@email.com</span>
						</div>
						<div class="col-md-5 pr-4 d-flex topper align-items-center text-lg-right">
							<span class="text">3-5 Business days delivery &amp; Free Returns</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
		<div class="container">
			<a class="navbar-brand" href="index.html">Brandy</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav"
				aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
				<span class="oi oi-menu"></span> Menu
			</button>

			<div class="collapse navbar-collapse" id="ftco-nav">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item"><a href="/home" class="nav-link">Home</a></li>
					<li class="nav-item dropdown active">
						<a class="nav-link dropdown-toggle" href="#" id="dropdown04" data-toggle="dropdown"
							aria-haspopup="true" aria-expanded="false">Catalog</a>
						<div class="dropdown-menu" aria-labelledby="dropdown04">
							<a class="dropdown-item" href="#">Profile</a>
							{{!-- <a class="dropdown-item" href="product-single.html">Single Product</a> --}}
							<a class="dropdown-item" href="/cart">Cart</a>
							{{!-- <a class="dropdown-item" href="checkout.html">Checkout</a> --}}
						</div>
					</li>
					{{!-- <li class="nav-item"><a href="about.html" class="nav-link">About</a></li>
					<li class="nav-item"><a href="blog.html" class="nav-link">Blog</a></li>
					<li class="nav-item"><a href="contact.html" class="nav-link">Contact</a></li> --}}
					<li class="nav-item cta cta-colored"><a href="/cart" class="nav-link"><span
								class="icon-shopping_cart"></span>[0]</a></li>

				</ul>
			</div>
		</div>
	</nav>
	<!-- END nav -->

	<div class="hero-wrap hero-bread" style="background-image: url('/userassets/images/bg_6.jpg');">
		<div class="container">
			<div class="row no-gutters slider-text align-items-center justify-content-center">
				<div class="col-md-9 ftco-animate text-center">
					<p class="breadcrumbs"><span class="mr-2"><a href="/home">Home</a></span> <span>Checkout</span></p>
					<h1 class="mb-0 bread">Checkout</h1>
				</div>
			</div>
		</div>
	</div>

	<section class="ftco-section">
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-xl-10 ftco-animate">
					{{!-- {{#each address}} --}}
					<div class="row mb-3">

						{{#each address}}
						<div class="col-lg-4 mb-3">
							
							<div style="background-color: rgba(238, 235, 235, 0.829); color: rgb(44, 39, 39);"
								class="form-check h-100 border rounded-3">
								   <span class="circle">
                             <a href="/checkoutPageDeleteAddress?id={{this._id}}"> <i class="fa fa-trash delete-icon" style="color: red; height:20px"></i></a> 
                                
                            </span>

                            <span class="circle">
                                <a href="/checkoutPageEditAddress?id={{this._id}}"><i class="fa-solid fa-pen" style="color: rgb(60, 20, 238); height:20px"></i></a>
                            </span>

								<div class="p-2">
									
									<form id="myForm"></form>
									
									<input class="form-check-input" value="{{this._id}}" type="radio"
										name="addressForDelivery" id="flexRadioDefault1" onclick="handleClick(this)">
									</form>

									<label class="form-check-label" for="flexRadioDefault1">


										{{this.firstname}} <br>
										{{this.firstname}} <br>
										{{this.state}} <br>
										{{this.address1}} <br>
										{{this.address2}} <br>
										{{this.city}} <br>
										{{this.pincode}} <br>
										{{this.mobile}} <br>

										{{!-- {{this.firstname}}</br> --}}

										3-4 days via Fedex


									</label>
								</div>

							</div>
						</div>
						{{/each}}
						<a href="/checkoutaddAddress">
							<div class="p-3 card-child mt-4 py-4">
								<div class="d-flex flex-row align-items-center">
									<span class="circle-3">
										<i class="fa fa-plus"></i>
									</span>
									<div class="d-flex flex-column ms-3 m-3">
										<h6 class="fw-bold text-primary">Add New Address</h6>
									</div>
								</div>
							</div>
						</a>



					</div>


					<!-- END -->

					{{!-- {{/each}} --}}



					<div class="row mt-5 pt-3 d-flex">
						<div class="col-md-6 d-flex">
							<div class="cart-detail cart-total bg-light p-3 p-md-4">
								<h3 class="billing-heading mb-4">Cart Total</h3>

							

								{{#each subTotal}}
								<p class="d-flex">
									<span>Subtotal</span>
									<span>Rs.{{this.SubTotal}}</span> <br>
								</p>
								{{/each}}
								<p class="d-flex">
									<span>Delivery</span>
									<span>Rs.0.00</span>
								</p>
								<p class="d-flex " >
									<span>Coupon Discount</span>
									<span id="couponDiscount">Rs.0.00</span>
									
								</p>
									<div>
										<span id="couponDiscountValue" hidden >0</span>
									{{!-- <label>
										<input type="radio" name="radioGroup" value="option1" onclick="walletRadioClick(this); this.onclick = null;"> Use Wallet Balance  
									</label> --}}
									<div class="form-check">
  									<input class="form-check-input" onclick="walletRadioClick(this);" type="checkbox" value="" id="flexCheckDefault">
 									 {{!-- <label class="form-check-label" for="flexCheckDefault"> --}}
											<p class="d-flex " >
									<span>Use Wallet Balance</span>
									<span id="couponDiscount">Rs.{{this.wallet.balance}} </span>
								</p>
  												  {{!-- Use Wallet Balance {{this.wallet.balance}}  --}}
 									 {{!-- </label> --}}
									</div>
									{{!-- <p id="wallet-minus"></p> --}}
								</div>
								<div class="basket-module">
									<label for="promo-code">Enter a promotional code</label>
									<input id="promo-code" type="text" name="promo-code"  class="promo-code-field "  style="margin-top: 10px; padding: 1px; font-size: 16px; border: none; border-radius: 5px; color: #333; background-color: #f1efef; width: 200px;">
									<span id="couponErr"></span>
									<button class="btn btn-primary "onclick="applyCoupon()">Apply</button>
								</div>
								<hr>
								<p class="d-flex total-price">
									<span>Total</span>
									<span id="total">{{this.total}}</span>
								</p>
							</div>
		
							
						</div>
						
						<div class="col-md-6">
							<div class="cart-detail bg-light p-3 p-md-4">
								<h3 class="billing-heading mb-4">Payment Method</h3>
								<div class="form-group">
									<div class="col-md-12">
										<div class="radio">
											<label><input type="radio" name="paymentMethod" id="COD" value="COD"
													class="mr-2">Cash On Delivery</label>
										</div>
									</div>
								</div>
								<div class="form-group">
									<div class="col-md-12">
										<div class="radio">
											<label><input type="radio" name="paymentMethod" id="ONLINE" value="ONLINE"
													class="mr-2">Online Payment</label>
										</div>
									</div>
								</div>


								{{!-- <div class="form-group">
									<div class="col-md-12">
										<div class="checkbox">
											<label><input type="checkbox" value="" class="mr-2"> I have read and accept
												the terms and conditions</label>
										</div>
									</div>

								</div> --}}


								<p><a href="#" id="getDataButton" class="btn btn-primary py-3 px-4">Place an order</a>
								</p>
							</div>
						</div>
					</div>
				</div> <!-- .col-md-8 -->
			</div>
		</div>
	</section> <!-- .section -->


	<footer class="ftco-footer ftco-section">
		<div class="container">
			<div class="row">
				<div class="mouse">
					<a href="#" class="mouse-icon">
						<div class="mouse-wheel"><span class="ion-ios-arrow-up"></span></div>
					</a>
				</div>
			</div>
			<div class="row mb-5">
				<div class="col-md">
					<div class="ftco-footer-widget mb-4">
						<h2 class="ftco-heading-2">Brandy</h2>
						<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia.</p>
						<ul class="ftco-footer-social list-unstyled float-md-left float-lft mt-5">
							<li class="ftco-animate"><a href="#"><span class="icon-twitter"></span></a></li>
							<li class="ftco-animate"><a href="#"><span class="icon-facebook"></span></a></li>
							<li class="ftco-animate"><a href="#"><span class="icon-instagram"></span></a></li>
						</ul>
					</div>
				</div>
				<div class="col-md">
					<div class="ftco-footer-widget mb-4 ml-md-5">
						<h2 class="ftco-heading-2">Menu</h2>
						<ul class="list-unstyled">
							<li><a href="#" class="py-2 d-block">Shop</a></li>
							<li><a href="#" class="py-2 d-block">About</a></li>
							<li><a href="#" class="py-2 d-block">Journal</a></li>
							<li><a href="#" class="py-2 d-block">Contact Us</a></li>
						</ul>
					</div>
				</div>
				<div class="col-md-4">
					<div class="ftco-footer-widget mb-4">
						<h2 class="ftco-heading-2">Help</h2>
						<div class="d-flex">
							<ul class="list-unstyled mr-l-5 pr-l-3 mr-4">
								<li><a href="#" class="py-2 d-block">Shipping Information</a></li>
								<li><a href="#" class="py-2 d-block">Returns &amp; Exchange</a></li>
								<li><a href="#" class="py-2 d-block">Terms &amp; Conditions</a></li>
								<li><a href="#" class="py-2 d-block">Privacy Policy</a></li>
							</ul>
							<ul class="list-unstyled">
								<li><a href="#" class="py-2 d-block">FAQs</a></li>
								<li><a href="#" class="py-2 d-block">Contact</a></li>
							</ul>
						</div>
					</div>
				</div>
				<div class="col-md">
					<div class="ftco-footer-widget mb-4">
						<h2 class="ftco-heading-2">Have a Questions?</h2>
						<div class="block-23 mb-3">
							<ul>
								<li><span class="icon icon-map-marker"></span><span class="text">203 Fake St. Mountain
										View, San Francisco, California, USA</span></li>
								<li><a href="#"><span class="icon icon-phone"></span><span class="text">+2 392 3929
											210</span></a></li>
								<li><a href="#"><span class="icon icon-envelope"></span><span
											class="text">info@yourdomain.com</span></a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-md-12 text-center">

					<p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
						Copyright &copy;
						<script>document.write(new Date().getFullYear());</script> All rights reserved | This template
						is made with <i class="icon-heart color-danger" aria-hidden="true"></i> by <a
							href="https://colorlib.com" target="_blank">Colorlib</a>
						<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
					</p>
				</div>
			</div>
		</div>
	</footer>



	<!-- loader -->
	<div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px">
			<circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee" />
			<circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
				stroke="#F96D00" />
		</svg></div>


	<script src="userassets/js/jquery.min.js"></script>
	<script src="userassets/js/jquery-migrate-3.0.1.min.js"></script>
	<script src="userassets/js/popper.min.js"></script>
	<script src="userassets/js/bootstrap.min.js"></script>
	<script src="userassets/js/jquery.easing.1.3.js"></script>
	<script src="userassets/js/jquery.waypoints.min.js"></script>
	<script src="userassets/js/jquery.stellar.min.js"></script>
	<script src="userassets/js/owl.carousel.min.js"></script>
	<script src="userassets/js/jquery.magnific-popup.min.js"></script>
	<script src="userassets/js/aos.js"></script>
	<script src="userassets/js/jquery.animateNumber.min.js"></script>
	<script src="userassets/js/bootstrap-datepicker.js"></script>
	<script src="userassets/js/scrollax.min.js"></script>
	<script
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
	<script src="userassets/js/google-map.js"></script>
	<script src="userassets/js/main.js"></script>

	  
<script>

  function applyCoupon() {
            event.preventDefault();
            
			const couponDiscount= document.getElementById('couponDiscountValue').innerText
			 const couponCode = document.getElementById("promo-code").value
			 const totalElement = document.getElementById("total");
			 const total = parseFloat(totalElement.textContent);

			 

            $.ajax({
                url: '/verifyCoupon/' + couponCode,
                method: 'GET',
                success: (response) => {
                    if (response.status == true) {

                        $.ajax({
                            url: '/applyCoupon?coupon=' + couponCode+"&&total="+total,
                            method: 'GET',
                            success: (response) => {
                                console.log(response, '---');
                                if (response.status == true) {
									console.log("in here ")
                                    document.getElementById('couponErr').style.color = '#19ff11'
                                    document.getElementById('couponErr').innerText = "Coupon Applied SuccessFully"
                                    // document.getElementById('subTotal').innerText = total - response.discountAmount
                                    document.getElementById('total').innerText = 'â‚¹' + Math.floor(total - response.discountAmount)
									 document.getElementById('couponDiscount').innerText = 'Rs.' + response.discountAmount
									 document.getElementById('couponDiscountValue').innerText =response.discountAmount
                                  //  document.getElementById('totalVal').value = Math.floor(total - response.discountAmount)
                                  //  document.getElementById('couponOffer').innerText = response.discount + '%'
                                  //  document.getElementById('discountPercentage').value = response.discount
                                  //  document.getElementById('discountAmount').value = Math.ceil(response.discountAmount)

								//	console.log(document.getElementById('couponDiscountValue').innerText,"dicount")
                                } else {
									console.log("in here22 ")
                                    document.getElementById('couponErr').style.color = "#ff0707"
                                    document.getElementById('couponErr').innerText = response.message
                                }

                            }
                        })
                    } else {
                        document.getElementById('couponErr').style.color = "#ff0707"
                        document.getElementById('couponErr').innerText = response.message

                        setTimeout(function () {
                            location.reload()
                        }, 5000)
                    }

                }
            })
        }

</script>

<script>
	function walletRadioClick(radioButton){
		let Wallet={{this.wallet.balance}}
			let walletRealBalance={{this.wallet.balance}}
			let walletBalance;
		 if (radioButton.checked) {
            const totalElement = document.getElementById("total");
			const total = parseFloat(totalElement.textContent);
			let Wallet={{this.wallet.balance}}
			let walletRealBalance={{this.wallet.balance}}
			let walletBalance;

			if(total<Wallet){
				totalElement.textContent=1
				walletBalance=(Wallet-total)+1
			}else if(total>Wallet){
				let totalAmt = total-Wallet
				totalElement.textContent=totalAmt
				let element = document.getElementById("wallet-minus");
				walletBalance=0
				element.innerHTML = Wallet;
			}
		
			


                console.log(total,Wallet,"Radio button is checked");
            }else if (!radioButton.checked){
				console.log(walletRealBalance,"unchecked")
				 const totalElement = document.getElementById("total");
				totalElement.textContent={{this.total}}
					walletBalance=walletRealBalance
			
			}
	}
</script>

	<script>
		let addressId;

		function handleClick(element) {
			// Get the value of the selected radio button
			addressId = element.value;
			console.log("Selected Value:", addressId);

			// AJAX call inside the handleClick function
			$.ajax({
				url: '/changePrimaryAddress',
				data: {
					addressId: addressId
				},
				method: 'post',
				success: (response) => {
					console.log("succeeded ");
				},
				error: (error) => {
					console.log("failed ", error);
				}
			});
		}
	</script>


	<script>

		document.addEventListener("DOMContentLoaded", function () {
			const getDataButton = document.getElementById("getDataButton");
			getDataButton.addEventListener("click", function () {



				const codRadioButton = document.getElementById("COD");
				const onlineRadioButton = document.getElementById("ONLINE");



				const totalElement = document.getElementById("total");
				const total = parseFloat(totalElement.textContent);





				let paymentMethod;
				if (codRadioButton.checked) {
					paymentMethod = codRadioButton.value;
				} else if (onlineRadioButton.checked) {
					paymentMethod = onlineRadioButton.value;
				} else {
					alert("Select a  Payment Method: ");

				}



				checkout()

				function checkout() {
					const couponDiscount= document.getElementById('couponDiscountValue').innerText
					const totalElement = document.getElementById("total");
			 const total = parseFloat(totalElement.textContent);

					const couponCode = document.getElementById("promo-code").value
					let checkbox = document.getElementById("flexCheckDefault");
					let walletUsed=false;
					if(checkbox.checked){
						walletUsed=true
					}

					console.log(couponDiscount,"ajjx checkout");
					$.ajax({
						url: '/checkout',
						data: {
							paymentMethod: paymentMethod,
							total: total,
							walletUsed,
							couponCode,
							couponDiscount


						},
						method: 'post',
						success: (response) => {
							console.log("succeeded ajjx")
							if (response.checkoutcomplete) {

								window.location.href = '/orderSuccess'
							}
							else {
								console.log("here1")
								razorpayPayment(response)

							}
						}
					});
				}

				function razorpayPayment(order) {
					console.log("here2")
					let options = {
						"key": "rzp_test_dnjs6k85WVuHl7", // Enter the Key ID generated from the Dashboard
						"amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
						"currency": "INR",
						"name": "BrandY", //your business name
						"description": "Test Transaction",
						"image": "https://example.com/your_logo",
						"order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
						"handler": function (response) {


							verifyPayment(response, order)
						},
						"prefill": { //We recommend using the prefill parameter to auto-fill customer's contact information, especially their phone number
							"name": "Gaurav Kumar", //your customer's name
							"email": "gaurav.kumar@example.com",
							"contact": "9000090000"  //Provide the customer's phone number for better conversion rates 
						},
						"notes": {
							"address": "Razorpay Corporate Office"
						},
						"theme": {
							"color": "#3399cc"
						}
					};

					var rzp1 = new Razorpay(options);
					rzp1.open();
				}

				function verifyPayment(payment, order) {
					console.log("in verify payment")
					$.ajax({
						url: '/verify-payment',
						data: {
							payment,
							order
						},
						method: 'post',
						success: (response) => {
							if (response.status) {
								window.location.href = '/orderSuccess'
							} else {
								alert("Payment failed")
							}
						}

					})
				}
			});
		});




	</script>

	    <script src="https://kit.fontawesome.com/5f6d1ef682.js" crossorigin="anonymous"></script> 

</body>

</html>